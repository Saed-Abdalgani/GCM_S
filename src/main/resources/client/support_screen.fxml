<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1" 
            fx:controller="client.boundary.SupportScreen"
            style="-fx-background-color: #0f0f23;">
    
    <!-- Header -->
    <top>
        <HBox alignment="CENTER_LEFT" spacing="20" style="-fx-background-color: linear-gradient(to right, #00b894, #00a085); -fx-padding: 15 25;">
            <Button text="â† Back" onAction="#goBack"
                    style="-fx-background-color: rgba(255,255,255,0.2); -fx-text-fill: white; -fx-font-size: 12px; -fx-padding: 8 15; -fx-background-radius: 15;"/>
            <Label text="ðŸ’¬ Support Center" style="-fx-text-fill: white; -fx-font-size: 24px; -fx-font-weight: bold;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="+ New Ticket" onAction="#showNewTicketDialog"
                    style="-fx-background-color: white; -fx-text-fill: #00a085; -fx-font-size: 13px; -fx-font-weight: bold; -fx-padding: 10 20; -fx-background-radius: 20;"/>
        </HBox>
    </top>
    
    <!-- Main Content: Ticket List + Detail View -->
    <center>
        <HBox spacing="20" style="-fx-padding: 20;">
            <!-- Left: Ticket List -->
            <VBox spacing="15" prefWidth="320" style="-fx-background-color: #1a1a2e; -fx-background-radius: 15; -fx-padding: 15;">
                <Label text="My Tickets" style="-fx-text-fill: white; -fx-font-size: 18px; -fx-font-weight: bold;"/>
                <TextField fx:id="searchField" promptText="ðŸ” Search tickets..." 
                           style="-fx-background-color: #16213e; -fx-text-fill: white; -fx-prompt-text-fill: #666; -fx-font-size: 13px; -fx-padding: 10; -fx-background-radius: 10;"/>
                <ListView fx:id="ticketListView" VBox.vgrow="ALWAYS"
                          style="-fx-background-color: transparent; -fx-control-inner-background: transparent;"/>
                <Button text="â†» Refresh" onAction="#refreshTickets" prefWidth="290"
                        style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-font-size: 12px; -fx-padding: 10; -fx-background-radius: 10;"/>
            </VBox>
            
            <!-- Right: Ticket Detail / Chat View -->
            <VBox spacing="15" HBox.hgrow="ALWAYS" style="-fx-background-color: #1a1a2e; -fx-background-radius: 15; -fx-padding: 20;">
                <!-- Ticket Header -->
                <HBox alignment="CENTER_LEFT" spacing="15">
                    <VBox HBox.hgrow="ALWAYS">
                        <Label fx:id="ticketSubjectLabel" text="Select a ticket" 
                               style="-fx-text-fill: white; -fx-font-size: 18px; -fx-font-weight: bold;"/>
                        <Label fx:id="ticketStatusLabel" text="" 
                               style="-fx-text-fill: #aaa; -fx-font-size: 12px;"/>
                    </VBox>
                    <Button fx:id="escalateBtn" text="ðŸ“ž Escalate to Agent" onAction="#escalateTicket"
                            style="-fx-background-color: #e74c3c; -fx-text-fill: white; -fx-font-size: 12px; -fx-padding: 8 15; -fx-background-radius: 15;" visible="false"/>
                    <Button fx:id="closeBtn" text="âœ“ Close Ticket" onAction="#closeTicket"
                            style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-font-size: 12px; -fx-padding: 8 15; -fx-background-radius: 15;" visible="false"/>
                </HBox>
                
                <Separator style="-fx-background-color: #333;"/>
                
                <!-- Messages ScrollPane -->
                <ScrollPane fx:id="messagesScrollPane" fitToWidth="true" VBox.vgrow="ALWAYS"
                            style="-fx-background-color: transparent; -fx-background: transparent;">
                    <VBox fx:id="messagesContainer" spacing="10" style="-fx-padding: 10;">
                        <Label text="Select a ticket to view messages" 
                               style="-fx-text-fill: #666; -fx-font-size: 14px;"/>
                    </VBox>
                </ScrollPane>
                
                <!-- Message Input (visible only for open tickets) -->
                <HBox fx:id="messageInputBox" spacing="10" visible="false">
                    <TextField fx:id="messageInput" promptText="Type a message..." HBox.hgrow="ALWAYS"
                               style="-fx-background-color: #16213e; -fx-text-fill: white; -fx-prompt-text-fill: #666; -fx-font-size: 14px; -fx-padding: 12; -fx-background-radius: 10;"/>
                    <Button text="Send" onAction="#sendMessage"
                            style="-fx-background-color: #00b894; -fx-text-fill: white; -fx-font-size: 13px; -fx-font-weight: bold; -fx-padding: 12 25; -fx-background-radius: 10;"/>
                </HBox>
            </VBox>
        </HBox>
    </center>
    
    <!-- Footer -->
    <bottom>
        <HBox alignment="CENTER" spacing="20" style="-fx-background-color: #1a1a2e; -fx-padding: 10;">
            <Label fx:id="statusLabel" text="Ready" style="-fx-text-fill: #666; -fx-font-size: 11px;"/>
        </HBox>
    </bottom>
</BorderPane>
